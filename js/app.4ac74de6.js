(function(){"use strict";var t={4528:function(t,e,o){var n=o(5130),a=o(2261),r=o(6768);const l={id:"app"};function i(t,e,o,n,a,i){const s=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",l,[(0,r.bF)(s)])}var s={name:"App",setup(){return{}}},c=o(1241);const d=(0,c.A)(s,[["render",i]]);var u=d,m=o(1387),g=o(4232);const p={class:"home-container"},y={class:"d-flex justify-content-center w-50 mx-auto pb-4"},h={class:"d-flex align-items-center rounded-pill shadow my-blur gap-2 p-2 w-100"},v={class:"content-section flex-grow-1"};function f(t,e,o,n,a,l){const i=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",p,[e[3]||(e[3]=(0,r.Lk)("div",{class:"w-100"},[(0,r.Lk)("h1",{class:"my-title-xl-black text-center py-4 mb-0"},"雲林縣研究案統計")],-1)),(0,r.Lk)("div",y,[(0,r.Lk)("div",h,[(0,r.Lk)("button",{class:(0,g.C4)(["btn rounded-pill border-0 my-btn-transparent my-font-size-xs text-nowrap w-100 my-cursor-pointer",{"my-btn-blue":"basic-stats"===n.activeTab}]),onClick:e[0]||(e[0]=t=>n.switchTab("basic-stats"))}," 基本統計 ",2),(0,r.Lk)("button",{class:(0,g.C4)(["btn rounded-pill border-0 my-btn-transparent my-font-size-xs text-nowrap w-100 my-cursor-pointer",{"my-btn-blue":"case-count"===n.activeTab}]),onClick:e[1]||(e[1]=t=>n.switchTab("case-count"))}," 委托案件數 ",2),(0,r.Lk)("button",{class:(0,g.C4)(["btn rounded-pill border-0 my-btn-transparent my-font-size-xs text-nowrap w-100 my-cursor-pointer",{"my-btn-blue":"case-budget"===n.activeTab}]),onClick:e[2]||(e[2]=t=>n.switchTab("case-budget"))}," 平均金額 ",2)])]),(0,r.Lk)("div",v,[(0,r.bF)(i)])])}o(4114);var b={name:"HomeView",setup(){const t=(0,m.rd)(),e=(0,m.lq)(),o=(0,r.EW)((()=>e.path.includes("basic-stats")?"basic-stats":e.path.includes("case-count")?"case-count":e.path.includes("case-budget")?"case-budget":"basic-stats")),n=e=>{"basic-stats"===e?t.push("/basic-stats"):"case-count"===e?t.push("/case-count"):"case-budget"===e&&t.push("/case-budget")};return{activeTab:o,switchTab:n}}};const x=(0,c.A)(b,[["render",f],["__scopeId","data-v-3c1bb939"]]);var k=x;const w={class:"basic-stats-container"},L={class:"w-100 px-3"},_={class:"row"},C={class:"col-4"},E={class:"my-bgcolor-white rounded-4 border pt-3 mb-4 position-relative",style:{height:"320px"}},A={class:""},S={class:"p-3"},M={class:"d-flex justify-content-between"},z={class:"my-content-md-black"},$={class:"p-3"},T={class:"d-flex justify-content-between"},B={class:"my-content-md-black"},U={class:"d-flex justify-content-between pt-2"},N={class:"my-content-md-black"},j={class:"p-3"},P={class:"d-flex justify-content-between"},I={class:"my-content-md-black"},R={class:"col-8"},O={class:"my-bgcolor-white rounded-4 border py-3 position-relative"},q={class:"row"},H={class:"col-6 mt-4"},X={class:"my-bgcolor-white rounded-4 border p-3 mb-4 position-relative"},W={class:"col-6 mt-4"},J={class:"my-bgcolor-white rounded-4 border p-3 mb-4 position-relative"};function V(t,e,o,n,a,l){return(0,r.uX)(),(0,r.CE)("div",w,[(0,r.Lk)("div",L,[(0,r.Lk)("div",_,[(0,r.Lk)("div",C,[(0,r.Lk)("div",E,[e[9]||(e[9]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black mb-3"},"委托案件數",-1)),(0,r.Lk)("div",A,[(0,r.Lk)("div",null,[(0,r.Lk)("div",S,[(0,r.Lk)("div",M,[e[3]||(e[3]=(0,r.Lk)("div",{class:"my-title-md-black"},"委托案件數",-1)),(0,r.Lk)("div",z,(0,g.v_)(n.countsSummary.全部?.toLocaleString?.()||n.countsSummary.全部),1)])]),e[7]||(e[7]=(0,r.Lk)("div",{class:"border-bottom my-color-gray-400"},null,-1)),(0,r.Lk)("div",$,[(0,r.Lk)("div",T,[e[4]||(e[4]=(0,r.Lk)("div",{class:"my-title-md-black"},"執行單位為學術單位",-1)),(0,r.Lk)("div",B,(0,g.v_)(n.countsSummary.學術?.toLocaleString?.()||n.countsSummary.學術),1)]),(0,r.Lk)("div",U,[e[5]||(e[5]=(0,r.Lk)("div",{class:"my-title-md-black"},"執行單位非學術單位",-1)),(0,r.Lk)("div",N,(0,g.v_)(n.countsSummary.非學術?.toLocaleString?.()||n.countsSummary.非學術),1)])]),e[8]||(e[8]=(0,r.Lk)("div",{class:"border-bottom my-color-gray-400"},null,-1)),(0,r.Lk)("div",j,[(0,r.Lk)("div",P,[e[6]||(e[6]=(0,r.Lk)("div",{class:"my-title-md-black"},"主管機關為雲林縣政府",-1)),(0,r.Lk)("div",I,(0,g.v_)(n.countsSummary.雲林?.toLocaleString?.()||n.countsSummary.雲林),1)])])])])])]),(0,r.Lk)("div",R,[(0,r.Lk)("div",O,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[0]||(e[0]=t=>n.exportContainerSvgAsPng("year-line","年度趨勢.png"))},e[10]||(e[10]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[11]||(e[11]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black mb-3"}," 委托案件數年度趨勢 ",-1)),e[12]||(e[12]=(0,r.Lk)("div",{id:"year-line",style:{height:"320px"}},null,-1)),e[13]||(e[13]=(0,r.Lk)("div",{id:"year-line-legend",class:"mt-2"},null,-1))])])]),(0,r.Lk)("div",q,[(0,r.Lk)("div",H,[(0,r.Lk)("div",X,[(0,r.Lk)("button",{class:"btn btn-sm position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[1]||(e[1]=t=>n.exportContainerSvgAsPng("field-cloud","研究領域_文字雲.png"))},e[14]||(e[14]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[15]||(e[15]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black mb-3"},"研究領域 文字雲",-1)),e[16]||(e[16]=(0,r.Lk)("div",{id:"field-cloud",style:{height:"360px",width:"100%"}},null,-1))])]),(0,r.Lk)("div",W,[(0,r.Lk)("div",J,[(0,r.Lk)("button",{class:"btn btn-sm position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[2]||(e[2]=t=>n.exportContainerSvgAsPng("keyword-cloud","中文關鍵詞_文字雲.png"))},e[17]||(e[17]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[18]||(e[18]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black mb-3"}," 中文關鍵詞 文字雲 ",-1)),e[19]||(e[19]=(0,r.Lk)("div",{id:"keyword-cloud",style:{height:"360px",width:"100%"}},null,-1))])])])])])}o(8111),o(2489),o(7588),o(1701);var F=o(144),G=o(9389);async function K(t,e="chart.png",o=void 0){const n=2,a="#ffffff",r="number"===typeof o,l=r?{scale:o,background:a}:{scale:o&&o.scale||n,background:o&&o.background||a},i=document.getElementById(t);if(!i)return;const s=i.querySelector("svg");if(!s)return;const c=s.cloneNode(!0),d=["fill","stroke","stroke-width","stroke-dasharray","stroke-linecap","stroke-linejoin","opacity","fill-opacity","stroke-opacity","font-family","font-size","font-weight","text-anchor","dominant-baseline","shape-rendering","letter-spacing"],u=[s,...s.querySelectorAll("*")],m=[c,...c.querySelectorAll("*")],g=Math.min(u.length,m.length);for(let E=0;E<g;E++){const t=u[E],e=m[E],o=window.getComputedStyle(t);d.forEach((t=>{const n=o.getPropertyValue(t);n&&"initial"!==n&&e.setAttribute(t,n)}))}c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const p=s.getBoundingClientRect(),y=Math.ceil(p.width||parseFloat(s.getAttribute("width"))||800),h=Math.ceil(p.height||parseFloat(s.getAttribute("height"))||600);c.setAttribute("width",String(y)),c.setAttribute("height",String(h));const v=new XMLSerializer,f=v.serializeToString(c),b=new Blob([f],{type:"image/svg+xml;charset=utf-8"}),x=URL.createObjectURL(b),k=new Image;await new Promise(((t,e)=>{k.onload=t,k.onerror=e,k.src=x}));const w=document.createElement("canvas"),L=Math.max(1,Number.isFinite(l.scale)?Number(l.scale):n);w.width=Math.round(y*L),w.height=Math.round(h*L);const _=w.getContext("2d");_.imageSmoothingEnabled=!0,_.imageSmoothingQuality&&(_.imageSmoothingQuality="high"),_.scale(L,L),_.fillStyle=l.background||a,_.fillRect(0,0,y,h),_.drawImage(k,0,0,y,h),URL.revokeObjectURL(x);const C=document.createElement("a");C.download=e,C.href=w.toDataURL("image/png"),document.body.appendChild(C),C.click(),document.body.removeChild(C)}var D={name:"BasicStatsView",setup(){const t=(0,F.KR)({"全部":0,"學術":0,"非學術":0,"雲林":0}),e=async()=>{const e=G.Ltv("#year-line");e.selectAll("*").remove();const o=e.node().getBoundingClientRect().width,n=320,a=e.append("svg").attr("width",o).attr("height",n),r={top:0,right:0,bottom:32,left:32},l=o-r.left-r.right,i=n-r.top-r.bottom,s=a.append("g").attr("transform",`translate(${r.left},${r.top})`),c=await G.Pq9("/yulin-research/data/計畫年度.json"),d=c.map((t=>({year:+t["計畫年度"],"全部":+(t["委托案件數_全部"]??0),"學術":+(t["委托案件數_學術單位執行"]??0),"非學術":+(t["委托案件數_非學術單位執行"]??0),"雲林":+(t["委托案件數_雲林縣政府主管"]??0)}))).sort(((t,e)=>t.year-e.year)),u=G.czq(d,(t=>t.全部||0))||0,m=G.czq(d,(t=>t.學術||0))||0,g=G.czq(d,(t=>t.非學術||0))||0,p=G.czq(d,(t=>t.雲林||0))||0;t.value={"全部":Math.round(u),"學術":Math.round(m),"非學術":Math.round(g),"雲林":Math.round(p)};const y=d.map((t=>t.year)),[h,v]=G.Xxv(y),f=G.m4Y().domain([h-.5,v+.5]).range([0,l]),b=G.T9B(d,(t=>Math.max(t.全部||0,t.學術||0,t.雲林||0)))||1,x=t=>{let e=5;t>1e3?(e=250*Math.ceil(t/5e3),e<500&&(e=500)):t>100?(e=25*Math.ceil(t/500),e<50&&(e=50)):t>50?e=10:t>25&&(e=5),e%5!==0&&(e=5*Math.ceil(e/5));const o=Math.ceil(t/e)*e;return o/e<2?2*e:o},k=x(b),w=t=>{const e=[0];let o=5;while(t/o>4)o+=5;for(let n=o;n<=t;n+=o)if(e.push(n),e.length>=5)break;return e},L=w(k),_=G.m4Y().domain([0,k]).range([i,0]),C=G.V4s(_).tickValues(L).tickSize(0).tickFormat((t=>G.GPZ(",")(t))),E=G.l78(f).tickValues(y).tickFormat((t=>t)),A=s.append("g").attr("transform",`translate(0,${i})`).call(E);A.select(".domain").remove(),A.selectAll("text").style("font-size","10px"),s.append("g").call(C).select(".domain").remove(),s.selectAll(".grid-line").data(L).enter().append("line").attr("class","grid-line").attr("x1",0).attr("x2",l).attr("y1",(t=>_(t))).attr("y2",(t=>_(t))).attr("stroke","#bdbdbd").attr("stroke-width",1).attr("stroke-dasharray","3,3").attr("opacity",(t=>0===t?.8:.4)),G.Ubm(".line-tooltip").remove();const S=G.Ltv("body").append("div").attr("class","line-tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000").style("opacity",0),M=t=>G.n8j().x((t=>f(t.year))).y((e=>_(e[t]||0)));s.append("path").datum(d).attr("fill","none").attr("stroke","var(--my-color-blue)").attr("stroke-width",2).attr("d",M("全部")),s.append("path").datum(d).attr("fill","none").attr("stroke","var(--my-color-green)").attr("stroke-width",2).attr("d",M("學術")),s.append("path").datum(d).attr("fill","none").attr("stroke","var(--my-color-orange)").attr("stroke-width",2).attr("d",M("雲林"));const z=(t,e,o)=>{s.selectAll(`circle.point-${t}`).data(d).enter().append("circle").attr("class",`point-${t}`).attr("cx",(t=>f(t.year))).attr("cy",(e=>_(e[t]||0))).attr("r",2.5).attr("fill",e).style("cursor","default").on("mouseover",(function(e,n){S.style("opacity",1).html(`<div><strong>${o}</strong></div><div>年度：${n.year}</div><div>數量：${n[t]?.toLocaleString?.()||n[t]}</div>`)})).on("mousemove",(function(t){S.style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",(function(){S.style("opacity",0)}))};z("全部","var(--my-color-blue)","委托案件數_全部"),z("學術","var(--my-color-green)","委托案件數_學術單位執行"),z("雲林","var(--my-color-orange)","委托案件數_雲林縣政府主管");const $=G.Ltv("#year-line-legend").html("").append("div").attr("class","d-flex justify-content-center gap-4"),T=[{label:"全部",color:"var(--my-color-blue)"},{label:"執行單位為學術單位",color:"var(--my-color-green)"},{label:"主管機關為雲林縣政府",color:"var(--my-color-orange)"}],B=$.selectAll("div.legend-item").data(T).enter().append("div").attr("class","d-flex align-items-center legend-item");B.append("span").style("display","inline-block").style("width","12px").style("height","12px").style("border-radius","2px").style("margin-right","6px").style("background",(t=>t.color)),B.append("span").style("font-size","12px").text((t=>t.label))},o=async t=>{const e=G.Ltv(`#${t.containerId}`);e.selectAll("*").remove();const o=e.node().getBoundingClientRect().width,n=360,a=e.append("svg").attr("width",o).attr("height",n),r=await G.Pq9(t.url),l=r.map((e=>({text:e[t.textKey],value:+e[t.valueKey]}))).filter((t=>t.text&&t.value>0)),i=G.RWy().exponent(1.1).domain([0,G.T9B(l,(t=>t.value))]).range([12,42]),s=l.map((t=>({text:t.text,size:Math.max(10,Math.round(i(t.value))),value:t.value}))).sort(((t,e)=>e.size-t.size)),c=[],d=[],u=(t,e)=>{const o=G.Ltv("body").append("svg").attr("width",0).attr("height",0).style("position","absolute").style("left","-9999px").style("top","-9999px"),n=o.append("text").style("font-size",`${e}px`).style("font-family","Arial, Microsoft JhengHei, sans-serif").text(t),a=n.node().getBBox();return o.remove(),{w:a.width,h:a.height}},m=o/2,g=n/2,p=1,y=(t,e)=>!(t.r<e.l||t.l>e.r||t.b<e.t||t.t>e.b);s.forEach((t=>{let e=!1;for(let a=t.size;a>=10&&!e;a-=2){const{w:r,h:l}=u(t.text,a);for(let i=0;i<3e3&&!e;i++){const s=.35*i,u=2+2*s;let h=m+u*Math.cos(s),v=g+u*Math.sin(s),f={l:h-r/2-p,r:h+r/2+p,t:v-l/2-p,b:v+l/2+p};if(f.l<0||f.r>o||f.t<0||f.b>n)continue;if(d.some((t=>y(f,t))))continue;for(let t=0;t<140;t++){const t=m-h,e=g-v,a=Math.hypot(t,e)||1,i=h+t/a*1,s=v+e/a*1,c={l:i-r/2-p,r:i+r/2+p,t:s-l/2-p,b:s+l/2+p},u=c.l<0||c.r>o||c.t<0||c.b>n;if(u||d.some((t=>y(c,t))))break;h=i,v=s,f=c}const b=["var(--my-color-red)","var(--my-color-pink)","var(--my-color-deeporange)","var(--my-color-orange)","var(--my-color-amber)","var(--my-color-yellow)","var(--my-color-lime)","var(--my-color-light-green)","var(--my-color-green)","var(--my-color-teal)","var(--my-color-cyan)","var(--my-color-lightblue)","var(--my-color-blue)","var(--my-color-bluegrey)","var(--my-color-indigo)","var(--my-color-deeppurple)","var(--my-color-purple)","var(--my-color-brown)"];c.push({text:t.text,size:a,x:h,y:v,color:b[Math.floor(Math.random()*b.length)]}),d.push(f),e=!0}}}));const h=Math.min(60,Math.max(20,Math.floor(6e3/(c.length||1))));for(let v=0;v<h;v++)for(let t=0;t<c.length;t++){const e=c[t],{w:a,h:r}=u(e.text,e.size),l=m-e.x,i=g-e.y,s=Math.hypot(l,i)||1,h=e.x+l/s*1,v=e.y+i/s*1,f={l:h-a/2-p,r:h+a/2+p,t:v-r/2-p,b:v+r/2+p},b=f.l<0||f.r>o||f.t<0||f.b>n;if(b)continue;let x=!1;for(let o=0;o<d.length;o++)if(o!==t&&y(f,d[o])){x=!0;break}x||(c[t].x=h,c[t].y=v,d[t]=f)}a.selectAll("text").data(c).enter().append("text").attr("x",(t=>t.x)).attr("y",(t=>t.y)).attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size",(t=>`${t.size}px`)).style("font-family","Arial, Microsoft JhengHei, sans-serif").style("font-weight","bold").style("fill",(t=>t.color)).text((t=>t.text))};var n=null;return(0,r.sV)((()=>{const t=()=>{e(),o({containerId:"field-cloud",url:"/yulin-research/data/研究領域.json",textKey:"研究領域",valueKey:"數量"}),o({containerId:"keyword-cloud",url:"/yulin-research/data/中文關鍵詞.json",textKey:"中文關鍵詞",valueKey:"數量"})};t();let a=null;const r=()=>{a&&clearTimeout(a),a=setTimeout((()=>{t()}),200)};window.addEventListener("resize",r),n=r})),(0,r.hi)((()=>{G.Ubm(".word-cloud-tooltip").remove(),n&&window.removeEventListener("resize",n)})),{exportContainerSvgAsPng:K,countsSummary:t}}};const Y=(0,c.A)(D,[["render",V],["__scopeId","data-v-c5b81034"]]);var Q=Y;const Z={class:"case-count-container"},tt={class:"w-100 px-3"},et={class:"row"},ot={class:"col-6"},nt={class:"chart-container my-bgcolor-white rounded-4 border py-3 position-relative"},at={key:0,class:"alert alert-danger mb-3"},rt={key:1,class:"text-center text-muted mb-3"},lt={key:2,class:"text-center text-muted mb-3"},it={class:"row"},st={class:"chart-container my-bgcolor-white rounded-4 border py-3 position-relative"},ct=["onClick"],dt={class:"d-flex justify-content-center my-title-md-black"},ut=["id"],mt={class:"row"},gt={class:"col-12 mt-4"},pt={class:"my-bgcolor-white rounded-4 border p-3 position-relative"};function yt(t,e,o,n,a,l){return(0,r.uX)(),(0,r.CE)("div",Z,[(0,r.Lk)("div",tt,[(0,r.Lk)("div",et,[(0,r.Lk)("div",ot,[(0,r.Lk)("div",nt,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[0]||(e[0]=t=>n.exportContainerSvgAsPng("main-chart","案件數_主圖表.png"))},e[2]||(e[2]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[3]||(e[3]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black"}," 主管機關委托案件數統計 (前12名) ",-1)),n.debugInfo.error?((0,r.uX)(),(0,r.CE)("div",at," 載入錯誤："+(0,g.v_)(n.debugInfo.error),1)):(0,r.Q3)("",!0),n.debugInfo.loading?((0,r.uX)(),(0,r.CE)("div",rt,"載入中...")):(0,r.Q3)("",!0),n.debugInfo.hasData||n.debugInfo.loading||n.debugInfo.error?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",lt," 無資料 ")),e[4]||(e[4]=(0,r.Lk)("div",{id:"main-chart",style:{"min-height":"480px"}},null,-1))])]),e[5]||(e[5]=(0,r.Lk)("div",{class:"col-6"},[(0,r.Lk)("div",{class:"chart-container my-bgcolor-white rounded-4 border pt-3"},[(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black pb-3"}," 學術單位案件數分布 "),(0,r.Lk)("div",{id:"taiwan-map",style:{height:"480px","border-radius":"0 0 1rem 1rem"}})])],-1))]),(0,r.Lk)("div",it,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.getSupervisorChartsData,(t=>((0,r.uX)(),(0,r.CE)("div",{key:t.id,class:"col-3 mt-4"},[(0,r.Lk)("div",st,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e=>n.exportContainerSvgAsPng(t.id,t.title+"_小圖表.png")},e[6]||(e[6]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)]),8,ct),(0,r.Lk)("div",dt,(0,g.v_)(t.title),1),(0,r.Lk)("div",{id:t.id,style:{"min-height":"320px"}},null,8,ut)])])))),128))]),(0,r.Lk)("div",mt,[(0,r.Lk)("div",gt,[(0,r.Lk)("div",pt,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[1]||(e[1]=t=>n.exportContainerSvgAsPng("network-graph","案件數_關係圖.png"))},e[7]||(e[7]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[8]||(e[8]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black mb-3"}," 主管機關與執行單位關係網絡圖 ",-1)),e[9]||(e[9]=(0,r.Lk)("div",{id:"network-graph",style:{height:"600px",width:"100%"}},null,-1))])])]),e[10]||(e[10]=(0,r.Fv)('<div class="row" data-v-47c051bf><div class="col-12 mt-4" data-v-47c051bf><div class="my-bgcolor-white rounded-4 border p-3" data-v-47c051bf><div class="d-flex justify-content-center my-title-md-black mb-3" data-v-47c051bf> 學術單位案件數文字雲 </div><div id="word-cloud" style="height:400px;width:100%;" data-v-47c051bf></div></div></div></div>',1))])])}o(116),o(8237),o(7642),o(8004),o(3853),o(5876),o(2475),o(5024),o(1698);const ht=(0,a.nY)("data",(()=>{const t=(0,F.KR)([]),e=(0,F.KR)([]),o=(0,F.KR)([]),n=(0,F.KR)([]),a=(0,F.KR)(!1),l=(0,F.KR)(null),i=(0,r.EW)((()=>t.value.slice().sort(((t,e)=>e.委托案件數-t.委托案件數)).slice(0,10))),s=(0,r.EW)((()=>t.value.slice().sort(((t,e)=>e.所有相符資料_JSON-t.所有相符資料_JSON)).slice(0,10))),c=(0,r.EW)((()=>t.value.reduce(((t,e)=>t+e.委托案件數),0))),d=(0,r.EW)((()=>{if(0===t.value.length)return 0;const e=t.value.reduce(((t,e)=>t+e.所有相符資料_JSON),0);return e/t.value.length})),u=(0,r.EW)((()=>e.value.slice().sort(((t,e)=>e.委托案件數-t.委托案件數)).slice(0,12))),m=(0,r.EW)((()=>e.value.slice().sort(((t,e)=>e.本期經費平均_千元-t.本期經費平均_千元)).slice(0,12))),g=t=>{const e=o.value.filter((e=>e.name===t)).sort(((t,e)=>e.委托案件數-t.委托案件數)).slice(0,10);return e},p=t=>{const e=o.value.filter((e=>e.name===t)).sort(((t,e)=>e.本期經費平均_千元-t.本期經費平均_千元)).slice(0,10);return e},y=(0,r.EW)((()=>{const t=u.value;return t.map((t=>{const e=g(t.name);return console.log(`主管機關: ${t.name} -> 執行單位數: ${e.length}`),{...t,subUnits:e}}))})),h=(0,r.EW)((()=>{const t=m.value;return t.map((t=>{const e=p(t.name);return console.log(`主管機關: ${t.name} -> 執行單位數: ${e.length}`),{...t,subUnits:e}}))})),v=(0,r.EW)((()=>{const e=t.value.filter((t=>"TRUE"===t.學術單位));return e.map((t=>{const e=n.value.find((e=>e.name===t.name));return{...t,lat:e?.lat||null,lng:e?.lng||null,hasLocation:!(!e?.lat||!e?.lng)}})).filter((t=>t.hasLocation))})),f=async()=>{try{const t=await fetch("./data/計畫主管機關_normalize.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json(),n=o.map((t=>({name:t["計畫主管機關_normalize"],"委托案件數":t["委托案件數"],"所有相符資料_JSON":t["所有相符資料_JSON"],"學術單位":t["學術單位"],"本期經費總合_千元":t["本期經費總合_千元"],"本期經費平均_千元":t["本期經費平均_千元"]})));e.value=n,console.log("主管機關資料載入成功:",n.length,"筆資料"),console.log("前5名主管機關:",n.slice(0,5))}catch(t){console.error("載入主管機關資料失敗:",t),l.value=t.message}},b=async()=>{try{const t=await fetch("./data/執行單位名稱_normalize_&_計畫主管機關_normalize.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json(),n=e.map((t=>({name:t["計畫主管機關_normalize"],name_sub:t["執行單位名稱_normalize"],"委托案件數":t["委托案件數"],"所有相符資料_JSON":t["所有相符資料_JSON"],"本期經費總合_千元":t["本期經費總合_千元"],"本期經費平均_千元":t["本期經費平均_千元"]})));o.value=n,console.log("主管機關-執行單位映射資料載入成功:",n.length,"筆資料")}catch(t){console.error("載入主管機關-執行單位映射資料失敗:",t),l.value=t.message}},x=async()=>{try{const e=await fetch("./data/執行單位名稱_normalize.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json(),n=o.map((t=>({name:t["執行單位名稱_normalize"],"委托案件數":t["委托案件數"],"所有相符資料_JSON":t["所有相符資料_JSON"],"本期經費總合_千元":t["本期經費總合_千元"],"本期經費平均_千元":t["本期經費平均_千元"],"學術單位":t["學術單位"]})));t.value=n,console.log("執行單位資料載入成功:",n.length,"筆資料");const a=n.filter((t=>t.name.includes("大學")||t.name.includes("學院"))).length;console.log("包含學術單位的執行單位數量:",a)}catch(e){console.error("載入執行單位資料失敗:",e),l.value=e.message}},k=async()=>{try{const t=await fetch("./data/執行單位名稱_locations.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();n.value=e,console.log("執行單位地理位置資料載入成功:",e.length,"筆資料")}catch(t){console.error("載入執行單位地理位置資料失敗:",t),l.value=t.message}},w=async()=>{a.value=!0,l.value=null;try{await Promise.all([f(),b(),x(),k()])}catch(t){l.value=t.message}finally{a.value=!1}},L=e=>e?t.value.filter((t=>t.name.toLowerCase().includes(e.toLowerCase()))):t.value;return{executingUnits:t,supervisorAgencies:e,supervisorExecutingMapping:o,executingUnitsLocations:n,loading:a,error:l,getTopExecutingUnits:i,getExecutingUnitsByBudget:s,getTotalCount:c,getAverageBudget:d,getTopSupervisorAgencies:u,getTopSupervisorAgenciesByBudget:m,getTop10AgenciesWithSubUnits:y,getTop10AgenciesWithSubUnitsByBudget:h,getUniversityExecutingUnitsWithLocation:v,loadSupervisorAgencies:f,loadSupervisorExecutingMapping:b,loadExecutingUnits:x,loadExecutingUnitsLocations:k,loadAllData:w,searchExecutingUnits:L}}));var vt=o(6886),ft=o.n(vt),bt={name:"CaseCountView",setup(){const t=ht(),e=(0,r.EW)((()=>{const e=t.getTop10AgenciesWithSubUnits.slice(0,12);return e.map(((t,e)=>({id:`supervisor-chart-${e+1}`,title:t.name,agencyData:{name:t.name,"委托案件數":t.委托案件數,"所有相符資料_JSON":t.所有相符資料_JSON},subUnits:t.subUnits||[]})))})),o=(0,r.EW)((()=>({hasData:t.supervisorAgencies.length>0,topUnitsCount:t.getTopSupervisorAgencies.length,loading:t.loading,error:t.error}))),n=t=>{const e=G.Ltv(`#${t.containerId}`);if(e.empty()||!e.node())return void console.error(`圖表容器 #${t.containerId} 不存在`);e.selectAll("*").remove();const o=t.data;if(!o||0===o.length)return void e.append("div").attr("class","d-flex align-items-center justify-content-center h-100").style("color","#666").text("載入中...");const n=e.node().getBoundingClientRect().width,a=("function"===typeof t.getContainerHeight?t.getContainerHeight():t.containerHeight)||320,r=t.margin||{top:20,right:0,bottom:160,left:40},l=("function"===typeof t.getChartHeight?t.getChartHeight():null)||160,i=n-r.left-r.right,s=l-r.top,c=e.append("svg").attr("width",n).attr("height",a),d=c.append("g").attr("transform",`translate(${r.left},${r.top})`),u="main-chart"===t.containerId,m=u?12:6,g=o.slice(0,m),p=Array.from({length:m},((t,e)=>g[e]?{...g[e],position:e,uniqueName:`pos-${e}-${g[e].name}`}:{name:`空位${e+1}`,value:0,fullName:"",isEmpty:!0,position:e,uniqueName:`pos-${e}-empty`})),y=16,h=p.length,v=h*y,f=i-v,b=f/(2*h),x=t=>{const e=p.findIndex((e=>e.uniqueName===t));return-1===e?0:b+e*(y+2*b)+y/2},k=G.T9B(g,(t=>t.value))||1,w=t=>{let e=5;t>1e3?(e=250*Math.ceil(t/5e3),e<500&&(e=500)):t>100?(e=25*Math.ceil(t/500),e<50&&(e=50)):t>50?e=10:t>25&&(e=5),e%5!==0&&(e=5*Math.ceil(e/5));const o=Math.ceil(t/e)*e;return o/e<2?2*e:o},L=w(k),_=G.m4Y().domain([0,L]).range([s,0]),C=t=>{const e=[0];let o=5;while(t/o>4)o+=5;for(let n=o;n<=t;n+=o)if(e.push(n),e.length>=5)break;return e},E=C(L);d.selectAll(".bar").data(p).enter().append("rect").attr("class","bar").attr("x",(t=>x(t.uniqueName)-y/2)).attr("y",(t=>_(t.value))).attr("width",y).attr("height",(t=>s-_(t.value))).attr("fill","var(--my-color-blue)");const A=p.filter((t=>!t.isEmpty&&t.value>0));d.selectAll(".bar-label").data(A).enter().append("text").attr("class","bar-label").attr("x",(t=>x(t.uniqueName))).attr("y",(t=>_(t.value)-5)).attr("text-anchor","middle").style("font-size","12px").style("fill","#333").style("font-weight","bold").text((t=>G.GPZ(",")(t.value))),d.selectAll(".grid-line").data(E).enter().append("line").attr("class","grid-line").attr("x1",0).attr("x2",i).attr("y1",(t=>_(t))).attr("y2",(t=>_(t))).attr("stroke","#bdbdbd").attr("stroke-width",1).attr("stroke-dasharray","3,3").attr("opacity",(t=>0===t?.8:.4));const S=d.append("g").attr("transform",`translate(0,${s})`);S.selectAll("text").remove(),p.forEach((t=>{if(!t.isEmpty&&t.name){const e=x(t.uniqueName),o=t.name,n=S.append("g").attr("transform",`translate(${e}, 20)`),a=[];for(let t=0;t<o.length;t+=10)a.push(o.substring(t,t+10));const r=a.length;a.forEach(((t,e)=>{const o=1===r?0:2===r?0===e?-8:8:3===r?0===e?-12:1===e?0:12:8*(e-(r-1)/2);t.split("").forEach(((t,e)=>{n.append("text").text(t).attr("x",o).attr("y",12.6*e).style("font-size","12px").style("font-family","Arial, sans-serif").style("fill","#333").style("text-anchor","middle")}))}))}})),d.append("g").call(G.V4s(_).tickValues(E).tickSize(0).tickFormat((t=>G.GPZ(",")(t)))).style("font-size","11px").select(".domain").remove(),d.selectAll(".tick text").style("fill","#666").style("font-weight","normal")},a=()=>{const t=e.value;t&&0!==t.length&&t.forEach((t=>{if(!t||!t.subUnits)return;const e=t.subUnits.slice(0,6).map((t=>t&&t.name_sub?{name:t.name_sub,uniqueName:t.name_sub,value:t.委托案件數||0,extra:{count:t.委托案件數||0,budget:Math.round(t.本期經費平均_千元||0)}}:null)).filter(Boolean);if(0===e.length)return;const o={containerId:t.id,data:e,yAxisLabel:"",containerHeight:320,tooltipTemplate:t=>`\n              <strong>${t.fullName}</strong><br/>\n              案件數: ${t.value}<br/>\n              平均預算: ${t.extra.budget}萬元<br/>\n              主管機關: ${t.extra.agencyName}\n            `};n(o)}))},l=()=>{const e=t.getTopSupervisorAgencies;return e&&0!==e.length?e.map((t=>t&&t.name?{name:t.name,uniqueName:t.name,value:t.委托案件數||0,extra:{count:t.委托案件數||0,budget:t.本期經費平均_千元||0}}:null)).filter(Boolean):[]},i=()=>{const e=t.supervisorAgencies;if(!e||0===e.length)return console.log("沒有主管機關數據"),{nodes:[],links:[]};const o=new Set;e.forEach((t=>{"TRUE"===t.學術單位&&o.add(t.name)})),console.log("學術單位主管機關:",[...o]);const n=t.supervisorExecutingMapping;if(!n||0===n.length)return console.log("沒有映射關係數據"),{nodes:[],links:[]};const a=n.filter((t=>o.has(t.name)));if(console.log("過濾前映射數據數量:",n.length),console.log("過濾後學術單位映射數量:",a.length),0===a.length)return console.log("沒有學術單位的映射關係"),{nodes:[],links:[]};const r=new Set;a.forEach((e=>{const o=t.executingUnits.find((t=>t.name===e.name_sub));o&&"TRUE"===o.學術單位&&r.add(e.name_sub)}));let l=[];o.forEach((t=>{const e=a.filter((e=>e.name===t)),o=e.reduce(((t,e)=>t+(e.委托案件數||0)),0),n=e.reduce(((t,e)=>t+(e.本期經費平均_千元||0)),0),r=e.length;l.push({id:`agency-${t}`,name:t,type:"agency",totalCount:o,totalBudget:n,projectCount:r,meanBudget:r>0?n/r:0,isAcademic:!0,academicStatus:"TRUE"})})),r.forEach((e=>{const o=a.filter((t=>t.name_sub===e)),n=o.reduce(((t,e)=>t+(e.委托案件數||0)),0),r=o.reduce(((t,e)=>t+(e.本期經費平均_千元||0)),0),i=o.length,s=t.executingUnits.find((t=>t.name===e)),c=s?s.學術單位:"FALSE";l.push({id:`unit-${e}`,name:e,type:"unit",totalCount:n,totalBudget:r,projectCount:i,meanBudget:i>0?r/i:0,isAcademic:"TRUE"===c,academicStatus:c})}));let i=a.filter((t=>r.has(t.name_sub))).map((t=>({source:`agency-${t.name}`,target:`unit-${t.name_sub}`,value:t.委托案件數||0})));const s=new Set(l.filter((t=>"unit"===t.type&&1===Number(t.totalCount))).map((t=>t.id)));if(s.size>0){let t=0,e=0,o=0;l.filter((t=>s.has(t.id))).forEach((n=>{t+=Number(n.totalCount)||0,e+=Number(n.totalBudget)||0,o+=Number(n.projectCount)||0}));const n=new Map;i.filter((t=>s.has(t.target))).forEach((t=>{const e=n.get(t.source)||0;n.set(t.source,e+(Number(t.value)||0))}));const a=i.filter((t=>!s.has(t.target)));if(o>0||t>0){const r="unit-其他",c={id:r,name:"其他",type:"unit",totalCount:t,totalBudget:e,projectCount:o,meanBudget:o>0?e/o:0,isAcademic:!0,academicStatus:"TRUE"},d=Array.from(n.entries()).map((([t,e])=>({source:t,target:r,value:e||1}))),u=l.filter((t=>!s.has(t.id)));u.push(c),l=u,i=a.concat(d)}}const c=10,d=new Set(l.filter((t=>Number(t.totalCount)>c)).map((t=>t.id)));return l=l.filter((t=>d.has(t.id))),i=i.filter((t=>d.has(t.source)&&d.has(t.target))),{nodes:l,links:i}},s=()=>{const t=i();if(!t.nodes||0===t.nodes.length){const t=G.Ltv("#network-graph");return void t.html('<div class="text-center text-muted p-5">暫無關係數據</div>')}const e=G.Ltv("#network-graph");e.selectAll("*").remove();const o=e.node().getBoundingClientRect(),n=o.width,a=600,r=e.append("svg").attr("width",n).attr("height",a),l=r.append("g"),s=G.s_O().scaleExtent([.1,3]).on("zoom",(t=>{l.attr("transform",t.transform)}));r.call(s);const c=G.tXi(t.nodes).force("link",G.kJC(t.links).id((t=>t.id)).distance(100)).force("charge",G.xJS().strength(-300)).force("center",G.jTM(n/2,a/2)).force("collision",G.eRw().radius((t=>{const e=1,o=t.totalCount*e,n=Math.sqrt(o/Math.PI);return Math.max(5,Math.min(n,100))}))),d=l.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("stroke","#999").attr("stroke-opacity",.6).attr("stroke-width",2),u=l.append("g").attr("class","nodes").selectAll("circle").data(t.nodes).enter().append("circle").attr("r",(t=>{const e=5,o=t.totalCount*e,n=Math.sqrt(o/Math.PI);return Math.max(5,Math.min(n,100))})).attr("fill",(t=>"agency"===t.type?"#4a90e2":"#f5a623")).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").call(G.$Er().on("start",p).on("drag",y).on("end",h)),m=l.append("g").attr("class","labels").selectAll("text").data(t.nodes).enter().append("text").text((t=>t.name.length>10?t.name.substring(0,10)+"...":t.name)).attr("font-size","12px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("text-anchor","middle").attr("dy","0.35em").style("pointer-events","none"),g=G.Ltv("body").append("div").attr("class","network-tooltip").style("position","absolute").style("padding","10px").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("border-radius","5px").style("font-size","12px").style("line-height","1.4").style("pointer-events","none").style("opacity",0).style("z-index","1000");function p(t,e){t.active||c.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function y(t,e){e.fx=t.x,e.fy=t.y}function h(t,e){t.active||c.alphaTarget(0),e.fx=null,e.fy=null}u.on("mouseover",(function(t,e){G.Ltv(this).transition().duration(200).attr("stroke-width",3).attr("stroke","#333");const o="agency"===e.type?"主管機關":"執行單位";let n=`\n              <div style="font-weight: bold; margin-bottom: 5px;">${o}</div>\n              <div style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">${e.name}</div>\n              <div>案件數: <span style="color: #4a90e2;">${e.totalCount}</span></div>\n              <div>平均金額: <span style="color: #50e3c2;">${Math.round(e.totalBudget/e.projectCount||0).toLocaleString()}</span>(千元)</div>\n            `;"unit"===e.type&&(n+='<div style="margin-top: 5px; color: #f5a623;">🏫 學術機構</div>'),g.html(n).style("opacity",1).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mousemove",(function(t){g.style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",(function(){G.Ltv(this).transition().duration(200).attr("stroke-width",2).attr("stroke","#fff"),g.transition().duration(200).style("opacity",0)})),c.on("tick",(()=>{d.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),u.attr("cx",(t=>t.x)).attr("cy",(t=>t.y)),m.attr("x",(t=>t.x)).attr("y",(t=>t.y))}))},c=()=>{const e=document.getElementById("taiwan-map");if(!e)return void console.warn("地圖容器 taiwan-map 不存在");e._leaflet_id&&(e._leaflet_id=null,e.innerHTML="");const o=ft().map("taiwan-map",{zoomControl:!1,attributionControl:!1}).setView([23.8,120.9],7);ft().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:""}).addTo(o);const n=t.getUniversityExecutingUnitsWithLocation;console.log("地圖數據:",{"總大學學院數":n.length,"有地理位置的數量":n.filter((t=>t.hasLocation)).length,"樣本數據":n.slice(0,3)}),0!==n.length?n.forEach((t=>{if(!t.hasLocation)return;const e=10,n=Math.sqrt(t.委托案件數*e/Math.PI),a=ft().circle([t.lat,t.lng],{color:"var(--my-color-red)",fillColor:"var(--my-color-red)",fillOpacity:.6,radius:1e3*n,weight:1}).addTo(o),r=`\n            <div>\n              <strong>${t.name}</strong><br/>\n              <div>\n                <div>委托案件數: ${t.委托案件數.toLocaleString()}</div>\n                <div>平均金額: ${Math.round(t.本期經費平均_千元).toLocaleString()}(千元)</div>\n              </div>\n            </div>\n          `;a.bindPopup(r,{maxWidth:300}),a.on("mouseover",(function(){this.setStyle({fillOpacity:.8,weight:3})})),a.on("mouseout",(function(){this.setStyle({fillOpacity:.6,weight:2})}))})):console.warn("沒有找到包含學術單位且有地理位置的執行單位數據")},d=()=>{const e=G.Ltv("#word-cloud");if(e.empty())return void console.warn("文字雲容器 #word-cloud 不存在");e.selectAll("*").remove();const o=t.executingUnits.filter((t=>"TRUE"===t.學術單位&&t.委托案件數>0));if(0===o.length)return void e.append("div").attr("class","d-flex align-items-center justify-content-center h-100").style("color","#666").text("無學術單位數據");const n=o.map((t=>t.委托案件數||0)),a=G.jkA(n)||0,r=G.T9B(n)||1,l=G.RWy().exponent(1.15).domain([a,r]).range([12,44]),i=o.map((t=>({text:t.name,size:Math.max(10,Math.round(l(t.委托案件數||0))),count:t.委托案件數,budget:t.本期經費平均_千元||0}))),s=e.node().getBoundingClientRect().width,c=400,d=e.append("svg").attr("width",s).attr("height",c),u=["var(--my-color-red)","var(--my-color-pink)","var(--my-color-deeporange)","var(--my-color-orange)","var(--my-color-amber)","var(--my-color-yellow)","var(--my-color-lime)","var(--my-color-light-green)","var(--my-color-green)","var(--my-color-teal)","var(--my-color-cyan)","var(--my-color-lightblue)","var(--my-color-blue)","var(--my-color-bluegrey)","var(--my-color-indigo)","var(--my-color-deeppurple)","var(--my-color-purple)","var(--my-color-brown)"],m=[],g=[],p=(t,e)=>{const o=G.Ltv("body").append("svg").attr("width",0).attr("height",0).style("position","absolute").style("left","-9999px").style("top","-9999px"),n=o.append("text").style("font-size",`${e}px`).style("font-family","Arial, Microsoft JhengHei, sans-serif").text(t),a=n.node().getBBox();return o.remove(),{width:a.width,height:a.height}},y=s/2,h=c/2,v=2,f=(t,e)=>!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom),b=[...i].sort(((t,e)=>e.size-t.size));b.forEach((t=>{let e=!1;for(let o=t.size;o>=10&&!e;o-=2){const{width:n,height:a}=p(t.text,o);for(let r=0;r<2e3&&!e;r++){const l=.35*r,i=2+2*l,d=y+i*Math.cos(l),p=h+i*Math.sin(l),b={left:d-n/2-v,right:d+n/2+v,top:p-a/2-v,bottom:p+a/2+v};if(b.left<0||b.right>s||b.top<0||b.bottom>c)continue;const x=g.some((t=>f(b,t)));if(!x){let r=d,l=p,i={...b};for(let t=0;t<80;t++){const t=y-r,e=h-l,o=Math.hypot(t,e)||1,d=1,u=r+t/o*d,m=l+e/o*d,p={left:u-n/2-v,right:u+n/2+v,top:m-a/2-v,bottom:m+a/2+v},b=p.left<0||p.right>s||p.top<0||p.bottom>c,x=g.some((t=>f(p,t)));if(b||x)break;r=u,l=m,i=p}const x={text:t.text,size:o,budget:t.budget,count:t.count,x:r,y:l,color:u[Math.floor(Math.random()*u.length)]};m.push(x),g.push(i),e=!0}}}})),d.selectAll("text").data(m).enter().append("text").style("font-size",(t=>`${t.size}px`)).style("font-family","Arial, Microsoft JhengHei, sans-serif").style("font-weight","bold").style("fill",(t=>t.color)).style("cursor","pointer").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("x",(t=>t.x)).attr("y",(t=>t.y)).text((t=>t.text)).on("mouseover",(function(t,e){G.Ltv(this).style("fill","var(--my-color-red)");const o=G.Ltv("body").append("div").attr("class","word-cloud-tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000");o.html(`\n              <div><strong>${e.text}</strong></div>\n              <div>委托案件數: ${e.count.toLocaleString()}</div>\n              <div>平均金額: ${Math.round(e.budget).toLocaleString()}(千元)</div>\n            `)})).on("mousemove",(function(t){G.Ltv(".word-cloud-tooltip").style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",(function(t,e){G.Ltv(this).style("font-size",`${e.size}px`).style("fill",e.color),G.Ltv(".word-cloud-tooltip").remove()}))};(0,r.sV)((async()=>{console.log("案件數統計頁面已初始化"),await t.loadAllData(),console.log("資料載入狀態:",{"主管機關數量":t.supervisorAgencies.length,"映射資料數量":t.supervisorExecutingMapping.length,"前十名主管機關":t.getTopSupervisorAgencies.length,"載入中":t.loading,"錯誤":t.error});const e=()=>{const t={containerId:"main-chart",data:l(),yAxisLabel:"",getChartHeight:()=>320,getContainerHeight:()=>480};n(t),a(),c(),s(),d()};(0,r.dY)((()=>{e();let t=null;const o=()=>{t&&clearTimeout(t),t=setTimeout((()=>{G.Ltv("#main-chart").selectAll("*").remove(),e()}),200)};window.addEventListener("resize",o),u=o}))}));let u=null;return(0,r.hi)((()=>{G.Ubm(".bar-label").remove(),G.Ubm(".network-tooltip").remove(),G.Ubm(".word-cloud-tooltip").remove(),u&&window.removeEventListener("resize",u)})),{dataStore:t,debugInfo:o,getSupervisorChartsData:e,exportContainerSvgAsPng:K}}};const xt=(0,c.A)(bt,[["render",yt],["__scopeId","data-v-47c051bf"]]);var kt=xt;const wt={class:"case-budget-container"},Lt={class:"w-100 px-3"},_t={class:"row"},Ct={class:"col-6"},Et={class:"chart-container my-bgcolor-white rounded-4 border py-3 position-relative"},At={key:0,class:"alert alert-danger mb-3"},St={key:1,class:"text-center text-muted mb-3"},Mt={key:2,class:"text-center text-muted mb-3"},zt={class:"row"},$t={class:"chart-container my-bgcolor-white rounded-4 border py-3 position-relative"},Tt=["onClick"],Bt={class:"d-flex justify-content-center my-title-md-black"},Ut=["id"],Nt={class:"row"},jt={class:"col-12 mt-4"},Pt={class:"my-bgcolor-white rounded-4 border p-3 position-relative"},It={class:"row"},Rt={class:"col-12 mt-4"},Ot={class:"my-bgcolor-white rounded-4 border p-3"},qt={class:"position-relative"};function Ht(t,e,o,n,a,l){return(0,r.uX)(),(0,r.CE)("div",wt,[(0,r.Lk)("div",Lt,[(0,r.Lk)("div",_t,[(0,r.Lk)("div",Ct,[(0,r.Lk)("div",Et,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[0]||(e[0]=t=>n.exportContainerSvgAsPng("main-chart","平均金額_主圖表.png"))},e[3]||(e[3]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[4]||(e[4]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black"}," 主管機關平均金額統計 (前12名) ",-1)),n.debugInfo.error?((0,r.uX)(),(0,r.CE)("div",At," 載入錯誤："+(0,g.v_)(n.debugInfo.error),1)):(0,r.Q3)("",!0),n.debugInfo.loading?((0,r.uX)(),(0,r.CE)("div",St,"載入中...")):(0,r.Q3)("",!0),n.debugInfo.hasData||n.debugInfo.loading||n.debugInfo.error?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Mt," 無資料 ")),e[5]||(e[5]=(0,r.Lk)("div",{id:"main-chart",style:{"min-height":"480px"}},null,-1))])]),e[6]||(e[6]=(0,r.Lk)("div",{class:"col-6"},[(0,r.Lk)("div",{class:"chart-container my-bgcolor-white rounded-4 border pt-3"},[(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black pb-3"}," 學術單位平均金額分布 "),(0,r.Lk)("div",{id:"taiwan-map",style:{height:"480px","border-radius":"0 0 1rem 1rem"}})])],-1))]),(0,r.Lk)("div",zt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.getSupervisorChartsData,(t=>((0,r.uX)(),(0,r.CE)("div",{key:t.id,class:"col-3 mt-4"},[(0,r.Lk)("div",$t,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e=>n.exportContainerSvgAsPng(t.id,t.title+"_小圖表.png")},e[7]||(e[7]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)]),8,Tt),(0,r.Lk)("div",Bt,(0,g.v_)(t.title),1),(0,r.Lk)("div",{id:t.id,style:{"min-height":"320px"}},null,8,Ut)])])))),128))]),(0,r.Lk)("div",Nt,[(0,r.Lk)("div",jt,[(0,r.Lk)("div",Pt,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[1]||(e[1]=t=>n.exportContainerSvgAsPng("network-graph","平均金額_關係圖.png"))},e[8]||(e[8]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[9]||(e[9]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black mb-3"}," 主管機關與執行單位關係網絡圖 ",-1)),e[10]||(e[10]=(0,r.Lk)("div",{id:"network-graph",style:{height:"600px",width:"100%"}},null,-1))])])]),(0,r.Lk)("div",It,[(0,r.Lk)("div",Rt,[(0,r.Lk)("div",Ot,[e[13]||(e[13]=(0,r.Lk)("div",{class:"d-flex justify-content-center my-title-md-black mb-3"}," 學術單位平均金額文字雲 ",-1)),(0,r.Lk)("div",qt,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary position-absolute",style:{top:"8px",right:"8px","z-index":"2",color:"var(--my-color-gray-400)","border-color":"var(--my-color-gray-400)"},title:"下載 PNG",onClick:e[2]||(e[2]=t=>n.exportContainerSvgAsPng("word-cloud","平均金額_文字雲.png"))},e[11]||(e[11]=[(0,r.Lk)("i",{class:"fa-solid fa-download"},null,-1)])),e[12]||(e[12]=(0,r.Lk)("div",{id:"word-cloud",style:{height:"400px",width:"100%"}},null,-1))])])])])])])}var Xt={name:"CaseBudgetView",setup(){const t=ht(),e=(0,r.EW)((()=>{const e=t.getTop10AgenciesWithSubUnitsByBudget.slice(0,12);return e.map(((t,e)=>({id:`supervisor-chart-${e+1}`,title:t.name,agencyData:{name:t.name,"委托案件數":t.委托案件數,"所有相符資料_JSON":t.所有相符資料_JSON},subUnits:t.subUnits||[]})))})),o=(0,r.EW)((()=>({hasData:t.supervisorAgencies.length>0,topUnitsCount:t.getTopSupervisorAgencies.length,loading:t.loading,error:t.error}))),n=t=>{const e=G.Ltv(`#${t.containerId}`);if(e.empty()||!e.node())return void console.error(`圖表容器 #${t.containerId} 不存在`);e.selectAll("*").remove();const o=t.data;if(!o||0===o.length)return void e.append("div").attr("class","d-flex align-items-center justify-content-center h-100").style("color","#666").text("載入中...");const n=e.node().getBoundingClientRect().width,a=("function"===typeof t.getContainerHeight?t.getContainerHeight():t.containerHeight)||320,r=t.margin||{top:16,right:0,bottom:160,left:56},l=("function"===typeof t.getChartHeight?t.getChartHeight():null)||160,i=n-r.left-r.right,s=l-r.top,c=e.append("svg").attr("width",n).attr("height",a),d=c.append("g").attr("transform",`translate(${r.left},${r.top})`),u="main-chart"===t.containerId,m=u?12:6,g=o.slice(0,m),p=Array.from({length:m},((t,e)=>g[e]?{...g[e],position:e,uniqueName:`pos-${e}-${g[e].name}`}:{name:`空位${e+1}`,value:0,fullName:"",isEmpty:!0,position:e,uniqueName:`pos-${e}-empty`})),y=16,h=p.length,v=h*y,f=i-v,b=f/(2*h),x=t=>{const e=p.findIndex((e=>e.uniqueName===t));return-1===e?0:b+e*(y+2*b)+y/2},k=G.T9B(g,(t=>t.value))||1,w=t=>{let e;e=t>1e5?5e4:t>5e4?2e4:t>2e4?1e4:t>1e4?5e3:t>5e3?1e3:t>1e3?500:100;const o=Math.ceil(t/e)*e;return{roundedMax:o,interval:e}},{roundedMax:L,interval:_}=w(k),C=G.m4Y().domain([0,L]).range([s,0]),E=(t,e)=>{const o=[0],n=Math.ceil(t/e);let a=e;n>4&&(a=Math.ceil(t/4),a=a>1e5?5e4*Math.ceil(a/5e4):a>5e4?2e4*Math.ceil(a/2e4):a>2e4?1e4*Math.ceil(a/1e4):a>1e4?5e3*Math.ceil(a/5e3):a>5e3?1e3*Math.ceil(a/1e3):a>1e3?500*Math.ceil(a/500):100*Math.ceil(a/100));for(let r=a;r<=t;r+=a)if(o.push(r),o.length>=5)break;return o},A=E(L,_);d.selectAll(".bar").data(p).enter().append("rect").attr("class","bar").attr("x",(t=>x(t.uniqueName)-y/2)).attr("y",(t=>C(t.value))).attr("width",y).attr("height",(t=>s-C(t.value))).attr("fill","var(--my-color-blue)");const S=p.filter((t=>!t.isEmpty&&t.value>0));d.selectAll(".bar-label").data(S).enter().append("text").attr("class","bar-label").attr("x",(t=>x(t.uniqueName))).attr("y",(t=>C(t.value)-5)).attr("text-anchor","middle").style("font-size","12px").style("fill","#333").style("font-weight","bold").text((t=>G.GPZ(",")(Math.round(t.value)))),d.selectAll(".grid-line").data(A).enter().append("line").attr("class","grid-line").attr("x1",0).attr("x2",i).attr("y1",(t=>C(t))).attr("y2",(t=>C(t))).attr("stroke","#bdbdbd").attr("stroke-width",1).attr("stroke-dasharray","3,3").attr("opacity",(t=>0===t?.8:.4));const M=d.append("g").attr("transform",`translate(0,${s})`);M.selectAll("text").remove(),p.forEach((t=>{if(!t.isEmpty){const e=x(t.uniqueName),o=t.name,n=M.append("g").attr("transform",`translate(${e}, 20)`),a=[];for(let t=0;t<o.length;t+=10)a.push(o.substring(t,t+10));const r=a.length;a.forEach(((t,e)=>{const o=1===r?0:2===r?0===e?-8:8:3===r?0===e?-12:1===e?0:12:8*(e-(r-1)/2);t.split("").forEach(((t,e)=>{n.append("text").text(t).attr("x",o).attr("y",12.6*e).style("font-size","12px").style("font-family","Arial, sans-serif").style("fill","#333").style("text-anchor","middle")}))}))}})),d.append("g").call(G.V4s(C).tickValues(A).tickSize(0).tickFormat((t=>G.GPZ(",")(t)))).style("font-size","11px").select(".domain").remove(),d.selectAll(".tick text").style("fill","#666").style("font-weight","normal")},a=()=>{const t=e.value;t&&0!==t.length&&t.forEach((t=>{if(!t||!t.subUnits)return;const e=t.subUnits.slice(0,6).map((t=>t&&t.name_sub?{name:t.name_sub,uniqueName:t.name_sub,value:t.本期經費平均_千元||0,extra:{count:t.委托案件數||0,budget:Math.round(t.本期經費平均_千元||0)}}:null)).filter(Boolean);if(0===e.length)return;const o={containerId:t.id,data:e,yAxisLabel:"",containerHeight:320,tooltipTemplate:t=>`\n              <strong>${t.fullName}</strong><br/>\n              平均預算: ${Math.round(t.value)}<br/>\n              平均預算: ${Math.round(t.extra.budget)}萬元<br/>\n              主管機關: ${t.extra.agencyName}\n            `};n(o)}))},l=()=>{const e=t.getTopSupervisorAgenciesByBudget;return e&&0!==e.length?e.map((t=>t&&t.name?{name:t.name,uniqueName:t.name,value:t.本期經費平均_千元||0,extra:{count:t.委托案件數||0,budget:t.本期經費平均_千元||0}}:null)).filter(Boolean):[]},i=()=>{const e=t.supervisorAgencies;if(!e||0===e.length)return console.log("沒有主管機關數據"),{nodes:[],links:[]};console.log("原始主管機關數據樣本:",e.slice(0,3)),console.log("主管機關數量:",e.length);const o=new Set,n=new Set;e.forEach((t=>{console.log(`檢查主管機關: ${t.name}, 學術單位標記: "${t.學術單位}"`),"TRUE"===t.學術單位?(o.add(t.name),console.log(`✓ ${t.name} 是學術單位`)):(n.add(t.name),console.log(`✗ ${t.name} 不是學術單位 (標記: "${t.學術單位}")`))})),console.log("學術單位主管機關:",[...o]),console.log("非學術單位主管機關:",[...n]);const a=t.supervisorExecutingMapping;if(!a||0===a.length)return console.log("沒有映射關係數據"),{nodes:[],links:[]};console.log("映射數據樣本:",a.slice(0,3)),console.log("映射數據數量:",a.length);const r=a.filter((t=>{const e=o.has(t.name);return e?console.log(`✓ 保留映射: ${t.name} -> ${t.name_sub}`):console.log(`✗ 過濾掉映射: ${t.name} -> ${t.name_sub} (非學術單位)`),e}));if(console.log("過濾前映射數據數量:",a.length),console.log("過濾後學術單位映射數量:",r.length),0===r.length)return console.log("沒有學術單位的映射關係"),{nodes:[],links:[]};const l=new Set;r.forEach((e=>{const o=t.executingUnits.find((t=>t.name===e.name_sub));o&&"TRUE"===o.學術單位&&l.add(e.name_sub)})),console.log("相關執行單位:",[...l]);let i=[];o.forEach((t=>{const e=r.filter((e=>e.name===t)),o=e.reduce(((t,e)=>t+(e.委托案件數||0)),0),n=e.reduce(((t,e)=>t+(e.本期經費平均_千元||0)),0),a=e.length;i.push({id:`agency-${t}`,name:t,type:"agency",totalCount:o,totalBudget:n,projectCount:a,meanBudget:a>0?n/a:0,isAcademic:!0,academicStatus:"TRUE"})})),l.forEach((e=>{const o=r.filter((t=>t.name_sub===e)),n=o.reduce(((t,e)=>t+(e.委托案件數||0)),0),a=o.reduce(((t,e)=>t+(e.本期經費平均_千元||0)),0),l=o.length,s=t.executingUnits.find((t=>t.name===e)),c=s?s.學術單位:"FALSE";i.push({id:`unit-${e}`,name:e,type:"unit",totalCount:n,totalBudget:a,projectCount:l,meanBudget:l>0?a/l:0,isAcademic:"TRUE"===c,academicStatus:c})}));let s=r.filter((t=>l.has(t.name_sub))).map((t=>({source:`agency-${t.name}`,target:`unit-${t.name_sub}`,value:t.本期經費平均_千元||0})));const c=2e3,d=new Set(i.filter((t=>"unit"===t.type&&(Number(t.meanBudget)||0)<=c)).map((t=>t.id)));if(d.size>0){let t=0,e=0,o=0;i.filter((t=>d.has(t.id))).forEach((n=>{t+=Number(n.totalCount)||0,e+=Number(n.totalBudget)||0,o+=Number(n.projectCount)||0}));const n=new Map;s.filter((t=>d.has(t.target))).forEach((t=>{const e=n.get(t.source)||0;n.set(t.source,e+(Number(t.value)||0))}));const a=s.filter((t=>!d.has(t.target)));if(o>0||e>0){const r="unit-其他",l={id:r,name:"其他",type:"unit",totalCount:t,totalBudget:e,projectCount:o,meanBudget:o>0?e/o:0,isAcademic:!0,academicStatus:"TRUE"},c=Array.from(n.entries()).map((([t,e])=>({source:t,target:r,value:e||0}))),u=i.filter((t=>!d.has(t.id)));u.push(l),i=u,s=a.concat(c)}}const u=new Set(i.filter((t=>"其他"===t.name||"unit"!==t.type||(Number(t.meanBudget)||0)>c)).map((t=>t.id)));return i=i.filter((t=>u.has(t.id))),s=s.filter((t=>u.has(t.source)&&u.has(t.target))),{nodes:i,links:s}},s=()=>{const t=i();if(!t.nodes||0===t.nodes.length){const t=G.Ltv("#network-graph");return void t.html('<div class="text-center text-muted p-5">暫無關係數據</div>')}const e=G.Ltv("#network-graph");e.selectAll("*").remove();const o=e.node().getBoundingClientRect(),n=o.width,a=600,r=e.append("svg").attr("width",n).attr("height",a),l=r.append("g"),s=G.s_O().scaleExtent([.1,3]).on("zoom",(t=>{l.attr("transform",t.transform)}));r.call(s);const c=G.tXi(t.nodes).force("link",G.kJC(t.links).id((t=>t.id)).distance(100)).force("charge",G.xJS().strength(-300)).force("center",G.jTM(n/2,a/2)).force("collision",G.eRw().radius((t=>{const e=.001,o=t.meanBudget*e,n=Math.sqrt(o/Math.PI);return Math.max(5,Math.min(n,100))}))),d=l.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("stroke","#999").attr("stroke-opacity",.6).attr("stroke-width",2),u=l.append("g").attr("class","nodes").selectAll("circle").data(t.nodes).enter().append("circle").attr("r",(t=>{const e=1,o=t.meanBudget*e,n=Math.sqrt(o/Math.PI);return Math.max(5,Math.min(n,100))})).attr("fill",(t=>"agency"===t.type?"#4a90e2":"#f5a623")).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").call(G.$Er().on("start",p).on("drag",y).on("end",h)),m=l.append("g").attr("class","labels").selectAll("text").data(t.nodes).enter().append("text").text((t=>t.name.length>10?t.name.substring(0,10)+"...":t.name)).attr("font-size","12px").attr("font-family","Arial, sans-serif").attr("fill","#333").attr("text-anchor","middle").attr("dy","0.35em").style("pointer-events","none"),g=G.Ltv("body").append("div").attr("class","network-tooltip").style("position","absolute").style("padding","10px").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("border-radius","5px").style("font-size","12px").style("line-height","1.4").style("pointer-events","none").style("opacity",0).style("z-index","1000");function p(t,e){t.active||c.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function y(t,e){e.fx=t.x,e.fy=t.y}function h(t,e){t.active||c.alphaTarget(0),e.fx=null,e.fy=null}u.on("mouseover",(function(t,e){G.Ltv(this).transition().duration(200).attr("stroke-width",3).attr("stroke","#333");const o="agency"===e.type?"主管機關":"執行單位";let n=`\n              <div style="font-weight: bold; margin-bottom: 5px;">${o}</div>\n              <div style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">${e.name}</div>\n              <div>案件數: <span style="color: #4a90e2;">${e.projectCount}</span></div>\n              <div>平均金額: <span style="color: #50e3c2;">${Math.round(e.meanBudget).toLocaleString()}</span>(千元)</div>\n            `;"unit"===e.type&&(n+='<div style="margin-top: 5px; color: #f5a623;">🏫 學術機構</div>'),g.html(n).style("opacity",1).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mousemove",(function(t){g.style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",(function(){G.Ltv(this).transition().duration(200).attr("stroke-width",2).attr("stroke","#fff"),g.transition().duration(200).style("opacity",0)})),c.on("tick",(()=>{d.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),u.attr("cx",(t=>t.x)).attr("cy",(t=>t.y)),m.attr("x",(t=>t.x)).attr("y",(t=>t.y))}))},c=()=>{const e=G.Ltv("#word-cloud");if(e.empty())return void console.warn("文字雲容器 #word-cloud 不存在");e.selectAll("*").remove();const o=t.executingUnits.filter((t=>"TRUE"===t.學術單位&&t.本期經費平均_千元>0));if(0===o.length)return void e.append("div").attr("class","d-flex align-items-center justify-content-center h-100").style("color","#666").text("無學術單位預算數據");const n=o.map((t=>t.本期經費平均_千元)),a=G.jkA(n)||0,r=G.T9B(n)||1,l=G.Bv9().domain([a,r]).range([12,40]),i=o.map((t=>({text:t.name,size:Math.max(10,Math.round(l(t.本期經費平均_千元))),budget:t.本期經費平均_千元,count:t.委托案件數||0}))),s=e.node().getBoundingClientRect().width,c=400,d=e.append("svg").attr("width",s).attr("height",c),u=["var(--my-color-red)","var(--my-color-pink)","var(--my-color-deeporange)","var(--my-color-orange)","var(--my-color-amber)","var(--my-color-yellow)","var(--my-color-lime)","var(--my-color-light-green)","var(--my-color-green)","var(--my-color-teal)","var(--my-color-cyan)","var(--my-color-lightblue)","var(--my-color-blue)","var(--my-color-bluegrey)","var(--my-color-indigo)","var(--my-color-deeppurple)","var(--my-color-purple)","var(--my-color-brown)"],m=[],g=[],p=(t,e)=>{const o=G.Ltv("body").append("svg").attr("width",0).attr("height",0).style("position","absolute").style("left","-9999px").style("top","-9999px"),n=o.append("text").style("font-size",`${e}px`).style("font-family","Arial, Microsoft JhengHei, sans-serif").text(t),a=n.node().getBBox();return o.remove(),{width:a.width,height:a.height}},y=s/2,h=c/2,v=2,f=(t,e)=>!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom),b=[...i].sort(((t,e)=>e.size-t.size));b.forEach((t=>{let e=!1;for(let o=t.size;o>=10&&!e;o-=2){const{width:n,height:a}=p(t.text,o);for(let r=0;r<2e3&&!e;r++){const l=.35*r,i=2+2*l,d=y+i*Math.cos(l),p=h+i*Math.sin(l),b={left:d-n/2-v,right:d+n/2+v,top:p-a/2-v,bottom:p+a/2+v};if(b.left<0||b.right>s||b.top<0||b.bottom>c)continue;const x=g.some((t=>f(b,t)));if(!x){let r=d,l=p,i={...b};for(let t=0;t<80;t++){const t=y-r,e=h-l,o=Math.hypot(t,e)||1,d=1,u=r+t/o*d,m=l+e/o*d,p={left:u-n/2-v,right:u+n/2+v,top:m-a/2-v,bottom:m+a/2+v},b=p.left<0||p.right>s||p.top<0||p.bottom>c,x=g.some((t=>f(p,t)));if(b||x)break;r=u,l=m,i=p}const x={text:t.text,size:o,budget:t.budget,count:t.count,x:r,y:l,color:u[Math.floor(Math.random()*u.length)]};m.push(x),g.push(i),e=!0}}}})),d.selectAll("text").data(m).enter().append("text").style("font-size",(t=>`${t.size}px`)).style("font-family","Arial, Microsoft JhengHei, sans-serif").style("font-weight","bold").style("fill",(t=>t.color)).style("cursor","pointer").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("x",(t=>t.x)).attr("y",(t=>t.y)).text((t=>t.text)).on("mouseover",(function(t,e){G.Ltv(this).style("fill","var(--my-color-red)");const o=G.Ltv("body").append("div").attr("class","word-cloud-tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000");o.html(`\n              <div><strong>${e.text}</strong></div>\n              <div>平均金額: ${Math.round(e.budget).toLocaleString()}(千元)</div>\n              <div>委托案件數: ${e.count.toLocaleString()}</div>\n            `)})).on("mousemove",(function(t){G.Ltv(".word-cloud-tooltip").style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",(function(t,e){G.Ltv(this).style("font-size",`${e.size}px`).style("fill",e.color),G.Ltv(".word-cloud-tooltip").remove()}))},d=()=>{const e=document.getElementById("taiwan-map");e._leaflet_id&&(e._leaflet_id=null,e.innerHTML="");const o=ft().map("taiwan-map",{zoomControl:!1,attributionControl:!1}).setView([23.8,120.9],7);ft().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:""}).addTo(o);const n=t.getUniversityExecutingUnitsWithLocation;if(console.log("地圖數據:",{"總大學學院數":n.length,"有地理位置的數量":n.filter((t=>t.hasLocation)).length,"樣本數據":n.slice(0,3)}),0===n.length)return void console.warn("沒有找到包含學術單位且有地理位置的執行單位數據");const a=n.map((t=>t.本期經費平均_千元)),r=Math.min(...a),l=Math.max(...a);console.log("平均預算金額範圍:",{"最小":r,"最大":l}),n.forEach((t=>{if(!t.hasLocation)return;const e=.15,n=Math.sqrt(t.本期經費平均_千元*e/Math.PI),a=ft().circle([t.lat,t.lng],{color:"var(--my-color-red)",fillColor:"var(--my-color-red)",fillOpacity:.6,radius:1e3*n,weight:1}).addTo(o),r=`\n            <div>\n              <strong>${t.name}</strong><br/>\n              <div>\n                <div>委托案件數: ${t.委托案件數.toLocaleString()}</div>\n                <div>平均金額: ${Math.round(t.本期經費平均_千元).toLocaleString()}(千元)</div>\n              </div>\n            </div>\n          `;a.bindPopup(r,{maxWidth:300}),a.on("mouseover",(function(){this.setStyle({fillOpacity:.8,weight:3})})),a.on("mouseout",(function(){this.setStyle({fillOpacity:.6,weight:2})}))}))};(0,r.sV)((async()=>{console.log("平均金額統計頁面已初始化"),await t.loadAllData(),console.log("資料載入狀態:",{"主管機關數量":t.supervisorAgencies.length,"映射資料數量":t.supervisorExecutingMapping.length,"前十名主管機關":t.getTopSupervisorAgencies.length,"載入中":t.loading,"錯誤":t.error});const e=()=>{const t={containerId:"main-chart",data:l(),yAxisLabel:"",getChartHeight:()=>320,getContainerHeight:()=>480};n(t),a(),d(),s(),c()};(0,r.dY)((()=>{e();let t=null;const o=()=>{t&&clearTimeout(t),t=setTimeout((()=>{G.Ltv("#main-chart").selectAll("*").remove(),e()}),200)};window.addEventListener("resize",o),u=o}))}));let u=null;return(0,r.hi)((()=>{G.Ubm(".bar-label").remove(),G.Ubm(".network-tooltip").remove(),G.Ubm(".word-cloud-tooltip").remove(),u&&window.removeEventListener("resize",u)})),{dataStore:t,debugInfo:o,getSupervisorChartsData:e,exportContainerSvgAsPng:K}}};const Wt=(0,c.A)(Xt,[["render",Ht],["__scopeId","data-v-f01050c8"]]);var Jt=Wt;const Vt=[{path:"/",name:"Home",component:k,meta:{title:"雲林縣研究案統計"},children:[{path:"",redirect:"/basic-stats"},{path:"basic-stats",name:"BasicStats",component:Q,meta:{title:"雲林縣研究案統計 - 基本統計"}},{path:"case-count",name:"CaseCount",component:kt,meta:{title:"雲林縣研究案統計 - 案件數分析"}},{path:"case-budget",name:"CaseBudget",component:Jt,meta:{title:"雲林縣研究案統計 - 預算分析"}}]}],Ft=(0,m.aE)({history:(0,m.LA)("/yulin-research/"),routes:Vt});Ft.beforeEach(((t,e,o)=>{document.title=t.meta.title||"雲林縣研究案統計",o()}));var Gt=Ft;const Kt=(0,n.Ef)(u),Dt=(0,a.Ey)();Kt.use(Dt),Kt.use(Gt),Kt.mount("#app"),console.log("雲林縣研究案統計平台已啟動")}},e={};function o(n){var a=e[n];if(void 0!==a)return a.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,o),r.exports}o.m=t,function(){var t=[];o.O=function(e,n,a,r){if(!n){var l=1/0;for(d=0;d<t.length;d++){n=t[d][0],a=t[d][1],r=t[d][2];for(var i=!0,s=0;s<n.length;s++)(!1&r||l>=r)&&Object.keys(o.O).every((function(t){return o.O[t](n[s])}))?n.splice(s--,1):(i=!1,r<l&&(l=r));if(i){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[n,a,r]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};o.O.j=function(e){return 0===t[e]};var e=function(e,n){var a,r,l=n[0],i=n[1],s=n[2],c=0;if(l.some((function(e){return 0!==t[e]}))){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(s)var d=s(o)}for(e&&e(n);c<l.length;c++)r=l[c],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return o.O(d)},n=self["webpackChunkyulin_research"]=self["webpackChunkyulin_research"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],(function(){return o(4528)}));n=o.O(n)})();
//# sourceMappingURL=app.4ac74de6.js.map